<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - coverage.info - test/mjsunit/track-fields.js</title>
  <link rel="stylesheet" type="text/css" href="../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../index.html">top level</a> - <a href="index.html">test/mjsunit</a> - track-fields.js<span style="font-size: 80%;"> (source / <a href="track-fields.js.func.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">coverage.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">410</td>
            <td class="headerCovTableEntry">410</td>
            <td class="headerCovTableEntryHi">100.0 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2017-02-14</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">23</td>
            <td class="headerCovTableEntry">25</td>
            <td class="headerCovTableEntryHi">92.0 %</td>
          </tr>
          <tr><td><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span><span class="lineCov">          1 : // Copyright 2013 the V8 project authors. All rights reserved.</span></a>
<span class="lineNum">       2 </span><span class="lineCov">          1 : // Redistribution and use in source and binary forms, with or without</span>
<span class="lineNum">       3 </span><span class="lineCov">          1 : // modification, are permitted provided that the following conditions are</span>
<span class="lineNum">       4 </span><span class="lineCov">          1 : // met:</span>
<span class="lineNum">       5 </span><span class="lineCov">          1 : //</span>
<span class="lineNum">       6 </span><span class="lineCov">          1 : //     * Redistributions of source code must retain the above copyright</span>
<span class="lineNum">       7 </span><span class="lineCov">          1 : //       notice, this list of conditions and the following disclaimer.</span>
<span class="lineNum">       8 </span><span class="lineCov">          1 : //     * Redistributions in binary form must reproduce the above</span>
<span class="lineNum">       9 </span><span class="lineCov">          1 : //       copyright notice, this list of conditions and the following</span>
<span class="lineNum">      10 </span><span class="lineCov">          1 : //       disclaimer in the documentation and/or other materials provided</span>
<span class="lineNum">      11 </span><span class="lineCov">          1 : //       with the distribution.</span>
<span class="lineNum">      12 </span><span class="lineCov">          1 : //     * Neither the name of Google Inc. nor the names of its</span>
<span class="lineNum">      13 </span><span class="lineCov">          1 : //       contributors may be used to endorse or promote products derived</span>
<span class="lineNum">      14 </span><span class="lineCov">          1 : //       from this software without specific prior written permission.</span>
<span class="lineNum">      15 </span><span class="lineCov">          1 : //</span>
<span class="lineNum">      16 </span><span class="lineCov">          1 : // THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<span class="lineNum">      17 </span><span class="lineCov">          1 : // &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<span class="lineNum">      18 </span><span class="lineCov">          1 : // LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
<span class="lineNum">      19 </span><span class="lineCov">          1 : // A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span>
<span class="lineNum">      20 </span><span class="lineCov">          1 : // OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
<span class="lineNum">      21 </span><span class="lineCov">          1 : // SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
<span class="lineNum">      22 </span><span class="lineCov">          1 : // LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
<span class="lineNum">      23 </span><span class="lineCov">          1 : // DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span>
<span class="lineNum">      24 </span><span class="lineCov">          1 : // THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<span class="lineNum">      25 </span><span class="lineCov">          1 : // (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<span class="lineNum">      26 </span><span class="lineCov">          1 : // OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<span class="lineNum">      27 </span><span class="lineCov">          1 : </span>
<span class="lineNum">      28 </span><span class="lineCov">          1 : // Flags: --track-fields --track-double-fields --allow-natives-syntax</span>
<span class="lineNum">      29 </span><span class="lineCov">          1 : </span>
<a name="30"><span class="lineNum">      30 </span><span class="lineCov">          1 : // Test transitions caused by changes to field representations.</span></a>
<span class="lineNum">      31 </span><span class="lineCov">          1 : </span>
<span class="lineNum">      32 </span><span class="lineCov">          3 : function create_smi_object() {</span>
<span class="lineNum">      33 </span><span class="lineCov">          3 :   var o = {};</span>
<span class="lineNum">      34 </span><span class="lineCov">          3 :   o.x = 1;</span>
<span class="lineNum">      35 </span><span class="lineCov">          3 :   o.y = 2;</span>
<span class="lineNum">      36 </span><span class="lineCov">          3 :   o.z = 3;</span>
<span class="lineNum">      37 </span><span class="lineCov">          3 :   return o;</span>
<span class="lineNum">      38 </span><span class="lineCov">          3 : }</span>
<span class="lineNum">      39 </span><span class="lineCov">          1 : </span>
<span class="lineNum">      40 </span><span class="lineCov">          1 : var o1 = create_smi_object();</span>
<span class="lineNum">      41 </span><span class="lineCov">          1 : var o2 = create_smi_object();</span>
<span class="lineNum">      42 </span><span class="lineCov">          1 : </span>
<span class="lineNum">      43 </span><span class="lineCov">          1 : // o1,o2 are smi, smi, smi</span>
<span class="lineNum">      44 </span><span class="lineCov">          1 : assertTrue(%HaveSameMap(o1, o2));</span>
<span class="lineNum">      45 </span><span class="lineCov">          1 : o1.y = 1.3;</span>
<span class="lineNum">      46 </span><span class="lineCov">          1 : // o1 is smi, double, smi</span>
<span class="lineNum">      47 </span><span class="lineCov">          1 : assertFalse(%HaveSameMap(o1, o2));</span>
<span class="lineNum">      48 </span><span class="lineCov">          1 : o2.y = 1.5;</span>
<span class="lineNum">      49 </span><span class="lineCov">          1 : // o2 is smi, double, smi</span>
<span class="lineNum">      50 </span><span class="lineCov">          1 : assertTrue(%HaveSameMap(o1, o2));</span>
<span class="lineNum">      51 </span><span class="lineCov">          1 : </span>
<span class="lineNum">      52 </span><span class="lineCov">          1 : // o3 is initialized as smi, double, smi</span>
<span class="lineNum">      53 </span><span class="lineCov">          1 : var o3 = create_smi_object();</span>
<a name="54"><span class="lineNum">      54 </span><span class="lineCov">          1 : assertTrue(%HaveSameMap(o1, o3));</span></a>
<span class="lineNum">      55 </span><span class="lineCov">          1 : </span>
<span class="lineNum">      56 </span><span class="lineCov">          3 : function set_large(o, v) {</span>
<span class="lineNum">      57 </span><span class="lineCov">          3 :   o.x01 = v; o.x02 = v; o.x03 = v; o.x04 = v; o.x05 = v; o.x06 = v; o.x07 = v;</span>
<span class="lineNum">      58 </span><span class="lineCov">          3 :   o.x08 = v; o.x09 = v; o.x10 = v; o.x11 = v; o.x12 = v; o.x13 = v; o.x14 = v;</span>
<span class="lineNum">      59 </span><span class="lineCov">          3 :   o.x15 = v; o.x16 = v; o.x17 = v; o.x18 = v; o.x19 = v; o.x20 = v; o.x21 = v;</span>
<span class="lineNum">      60 </span><span class="lineCov">          3 :   o.x22 = v; o.x23 = v; o.x24 = v; o.x25 = v; o.x26 = v; o.x27 = v; o.x28 = v;</span>
<span class="lineNum">      61 </span><span class="lineCov">          3 :   o.x29 = v; o.x30 = v; o.x31 = v; o.x32 = v; o.x33 = v; o.x34 = v; o.x35 = v;</span>
<span class="lineNum">      62 </span><span class="lineCov">          3 :   o.x36 = v; o.x37 = v; o.x38 = v; o.x39 = v; o.x40 = v; o.x41 = v; o.x42 = v;</span>
<span class="lineNum">      63 </span><span class="lineCov">          3 :   o.y01 = v; o.y02 = v; o.y03 = v; o.y04 = v; o.y05 = v; o.y06 = v; o.y07 = v;</span>
<span class="lineNum">      64 </span><span class="lineCov">          3 :   o.y08 = v; o.y09 = v; o.y10 = v; o.y11 = v; o.y12 = v; o.y13 = v; o.y14 = v;</span>
<span class="lineNum">      65 </span><span class="lineCov">          3 :   o.y15 = v; o.y16 = v; o.y17 = v; o.y18 = v; o.y19 = v; o.y20 = v; o.y21 = v;</span>
<span class="lineNum">      66 </span><span class="lineCov">          3 : }</span>
<span class="lineNum">      67 </span><span class="lineCov">          1 : </span>
<span class="lineNum">      68 </span><span class="lineCov">          1 : // Check that large object migrations work.</span>
<span class="lineNum">      69 </span><span class="lineCov">          1 : var o4 = {};</span>
<span class="lineNum">      70 </span><span class="lineCov">          1 : // All smi.</span>
<span class="lineNum">      71 </span><span class="lineCov">          1 : set_large(o4, 0);</span>
<span class="lineNum">      72 </span><span class="lineCov">          1 : assertTrue(%HasFastProperties(o4));</span>
<span class="lineNum">      73 </span><span class="lineCov">          1 : // All double.</span>
<span class="lineNum">      74 </span><span class="lineCov">          1 : set_large(o4, 1.5);</span>
<span class="lineNum">      75 </span><span class="lineCov">          1 : // o5 is immediately allocated with doubles.</span>
<span class="lineNum">      76 </span><span class="lineCov">          1 : var o5 = {};</span>
<span class="lineNum">      77 </span><span class="lineCov">          1 : set_large(o5, 0);</span>
<a name="78"><span class="lineNum">      78 </span><span class="lineCov">          1 : assertTrue(%HaveSameMap(o4, o5));</span></a>
<span class="lineNum">      79 </span><span class="lineCov">          1 : </span>
<span class="lineNum">      80 </span><span class="lineCov">          2 : function create_smi_object2() {</span>
<span class="lineNum">      81 </span><span class="lineCov">          2 :   var o = {};</span>
<span class="lineNum">      82 </span><span class="lineCov">          2 :   o.a = 1;</span>
<span class="lineNum">      83 </span><span class="lineCov">          2 :   o.b = 2;</span>
<span class="lineNum">      84 </span><span class="lineCov">          2 :   o.c = 3;</span>
<span class="lineNum">      85 </span><span class="lineCov">          2 :   return o;</span>
<span class="lineNum">      86 </span><span class="lineCov">          2 : }</span>
<span class="lineNum">      87 </span><span class="lineCov">          1 : </span>
<span class="lineNum">      88 </span><span class="lineCov">          1 : // All smi</span>
<span class="lineNum">      89 </span><span class="lineCov">          1 : var o6 = create_smi_object2();</span>
<span class="lineNum">      90 </span><span class="lineCov">          1 : var o7 = create_smi_object2();</span>
<span class="lineNum">      91 </span><span class="lineCov">          1 : </span>
<span class="lineNum">      92 </span><span class="lineCov">          1 : assertTrue(%HaveSameMap(o6, o7));</span>
<span class="lineNum">      93 </span><span class="lineCov">          1 : // Smi, double, smi.</span>
<span class="lineNum">      94 </span><span class="lineCov">          1 : o6.b = 1.5;</span>
<span class="lineNum">      95 </span><span class="lineCov">          1 : assertFalse(%HaveSameMap(o6, o7));</span>
<span class="lineNum">      96 </span><span class="lineCov">          1 : // Smi, double, object.</span>
<span class="lineNum">      97 </span><span class="lineCov">          1 : o7.c = {};</span>
<span class="lineNum">      98 </span><span class="lineCov">          1 : assertFalse(%HaveSameMap(o6, o7));</span>
<span class="lineNum">      99 </span><span class="lineCov">          1 : // Smi, double, object.</span>
<span class="lineNum">     100 </span><span class="lineCov">          1 : o6.c = {};</span>
<a name="101"><span class="lineNum">     101 </span><span class="lineCov">          1 : assertTrue(%HaveSameMap(o6, o7));</span></a>
<span class="lineNum">     102 </span><span class="lineCov">          1 : </span>
<span class="lineNum">     103 </span><span class="lineCov">          4 : function poly_load(o, b) {</span>
<span class="lineNum">     104 </span><span class="lineCov">          4 :   var v = o.field;</span>
<span class="lineNum">     105 </span><span class="lineCov">          4 :   if (b) {</span>
<span class="lineNum">     106 </span><span class="lineCov">          4 :     return v + 10;</span>
<span class="lineNum">     107 </span><span class="lineCov">          4 :   }</span>
<span class="lineNum">     108 </span><span class="lineCov">          4 :   return o;</span>
<span class="lineNum">     109 </span><span class="lineCov">          4 : }</span>
<span class="lineNum">     110 </span><span class="lineCov">          1 : </span>
<span class="lineNum">     111 </span><span class="lineCov">          1 : var of1 = {a:0};</span>
<span class="lineNum">     112 </span><span class="lineCov">          1 : of1.field = {};</span>
<span class="lineNum">     113 </span><span class="lineCov">          1 : var of2 = {b:0};</span>
<span class="lineNum">     114 </span><span class="lineCov">          1 : of2.field = 10;</span>
<span class="lineNum">     115 </span><span class="lineCov">          1 : </span>
<span class="lineNum">     116 </span><span class="lineCov">          1 : poly_load(of1, false);</span>
<span class="lineNum">     117 </span><span class="lineCov">          1 : poly_load(of1, false);</span>
<span class="lineNum">     118 </span><span class="lineCov">          1 : poly_load(of2, true);</span>
<span class="lineNum">     119 </span><span class="lineCov">          1 : %OptimizeFunctionOnNextCall(poly_load);</span>
<span class="lineNum">     120 </span><span class="lineCov">          1 : assertEquals(&quot;[object Object]10&quot;, poly_load(of1, true));</span>
<a name="121"><span class="lineNum">     121 </span><span class="lineCov">          1 : </span></a>
<span class="lineNum">     122 </span><span class="lineCov">          1 : // Ensure small object literals with doubles do not share double storage.</span>
<span class="lineNum">     123 </span><span class="lineCov">          2 : function object_literal() { return {&quot;a&quot;:1.5}; }</span>
<span class="lineNum">     124 </span><span class="lineCov">          1 : var o8 = object_literal();</span>
<span class="lineNum">     125 </span><span class="lineCov">          1 : var o9 = object_literal();</span>
<span class="lineNum">     126 </span><span class="lineCov">          1 : o8.a = 4.6</span>
<span class="lineNum">     127 </span><span class="lineCov">          1 : assertEquals(1.5, o9.a);</span>
<a name="128"><span class="lineNum">     128 </span><span class="lineCov">          1 : </span></a>
<span class="lineNum">     129 </span><span class="lineCov">          1 : // Ensure double storage is not leaked in the case of polymorphic loads.</span>
<span class="lineNum">     130 </span><span class="lineCov">          4 : function load_poly(o) {</span>
<span class="lineNum">     131 </span><span class="lineCov">          4 :   return o.a;</span>
<span class="lineNum">     132 </span><span class="lineCov">          4 : }</span>
<span class="lineNum">     133 </span><span class="lineCov">          1 : </span>
<span class="lineNum">     134 </span><span class="lineCov">          1 : var o10 = { &quot;a&quot;: 1.6 };</span>
<span class="lineNum">     135 </span><span class="lineCov">          1 : var o11 = { &quot;b&quot;: 1, &quot;a&quot;: 1.7 };</span>
<span class="lineNum">     136 </span><span class="lineCov">          1 : load_poly(o10);</span>
<span class="lineNum">     137 </span><span class="lineCov">          1 : load_poly(o10);</span>
<span class="lineNum">     138 </span><span class="lineCov">          1 : load_poly(o11);</span>
<span class="lineNum">     139 </span><span class="lineCov">          1 : %OptimizeFunctionOnNextCall(load_poly);</span>
<span class="lineNum">     140 </span><span class="lineCov">          1 : var val = load_poly(o10);</span>
<span class="lineNum">     141 </span><span class="lineCov">          1 : o10.a = 19.5;</span>
<span class="lineNum">     142 </span><span class="lineCov">          1 : assertFalse(o10.a == val);</span>
<span class="lineNum">     143 </span><span class="lineCov">          1 : </span>
<span class="lineNum">     144 </span><span class="lineCov">          1 : // Ensure polymorphic loads only go monomorphic when the representations are</span>
<span class="lineNum">     145 </span><span class="lineCov">          1 : // compatible.</span>
<a name="146"><span class="lineNum">     146 </span><span class="lineCov">          1 : </span></a>
<span class="lineNum">     147 </span><span class="lineCov">          1 : // Check polymorphic load from double + object fields.</span>
<span class="lineNum">     148 </span><span class="lineCov">          4 : function load_mono(o) {</span>
<span class="lineNum">     149 </span><span class="lineCov">          4 :   return o.a1;</span>
<span class="lineNum">     150 </span><span class="lineCov">          4 : }</span>
<span class="lineNum">     151 </span><span class="lineCov">          1 : </span>
<span class="lineNum">     152 </span><span class="lineCov">          1 : var object = {&quot;x&quot;: 1};</span>
<span class="lineNum">     153 </span><span class="lineCov">          1 : var o10 = { &quot;a1&quot;: 1.6 };</span>
<span class="lineNum">     154 </span><span class="lineCov">          1 : var o11 = { &quot;a1&quot;: object, &quot;b&quot;: 1 };</span>
<span class="lineNum">     155 </span><span class="lineCov">          1 : load_mono(o10);</span>
<span class="lineNum">     156 </span><span class="lineCov">          1 : load_mono(o10);</span>
<span class="lineNum">     157 </span><span class="lineCov">          1 : load_mono(o11);</span>
<span class="lineNum">     158 </span><span class="lineCov">          1 : %OptimizeFunctionOnNextCall(load_mono);</span>
<span class="lineNum">     159 </span><span class="lineCov">          1 : assertEquals(object, load_mono(o11));</span>
<a name="160"><span class="lineNum">     160 </span><span class="lineCov">          1 : </span></a>
<span class="lineNum">     161 </span><span class="lineCov">          1 : // Check polymorphic load from smi + object fields.</span>
<span class="lineNum">     162 </span><span class="lineCov">          4 : function load_mono2(o) {</span>
<span class="lineNum">     163 </span><span class="lineCov">          4 :   return o.a2;</span>
<span class="lineNum">     164 </span><span class="lineCov">          4 : }</span>
<span class="lineNum">     165 </span><span class="lineCov">          1 : </span>
<span class="lineNum">     166 </span><span class="lineCov">          1 : var o12 = { &quot;a2&quot;: 5 };</span>
<span class="lineNum">     167 </span><span class="lineCov">          1 : var o13 = { &quot;a2&quot;: object, &quot;b&quot;: 1 };</span>
<span class="lineNum">     168 </span><span class="lineCov">          1 : load_mono2(o12);</span>
<span class="lineNum">     169 </span><span class="lineCov">          1 : load_mono2(o12);</span>
<span class="lineNum">     170 </span><span class="lineCov">          1 : load_mono2(o13);</span>
<span class="lineNum">     171 </span><span class="lineCov">          1 : %OptimizeFunctionOnNextCall(load_mono2);</span>
<span class="lineNum">     172 </span><span class="lineCov">          1 : assertEquals(object, load_mono2(o13));</span>
<a name="173"><span class="lineNum">     173 </span><span class="lineCov">          1 : </span></a>
<span class="lineNum">     174 </span><span class="lineCov">          1 : // Check polymorphic load from double + double fields.</span>
<span class="lineNum">     175 </span><span class="lineCov">          5 : function load_mono3(o) {</span>
<span class="lineNum">     176 </span><span class="lineCov">          5 :   return o.a3;</span>
<span class="lineNum">     177 </span><span class="lineCov">          5 : }</span>
<span class="lineNum">     178 </span><span class="lineCov">          1 : </span>
<span class="lineNum">     179 </span><span class="lineCov">          1 : var o14 = { &quot;a3&quot;: 1.6 };</span>
<span class="lineNum">     180 </span><span class="lineCov">          1 : var o15 = { &quot;a3&quot;: 1.8, &quot;b&quot;: 1 };</span>
<span class="lineNum">     181 </span><span class="lineCov">          1 : load_mono3(o14);</span>
<span class="lineNum">     182 </span><span class="lineCov">          1 : load_mono3(o14);</span>
<span class="lineNum">     183 </span><span class="lineCov">          1 : load_mono3(o15);</span>
<span class="lineNum">     184 </span><span class="lineCov">          1 : %OptimizeFunctionOnNextCall(load_mono3);</span>
<span class="lineNum">     185 </span><span class="lineCov">          1 : assertEquals(1.6, load_mono3(o14));</span>
<span class="lineNum">     186 </span><span class="lineCov">          1 : assertEquals(1.8, load_mono3(o15));</span>
<span class="lineNum">     187 </span><span class="lineCov">          1 : </span>
<span class="lineNum">     188 </span><span class="lineCov">          1 : // Check that JSON parsing respects existing representations.</span>
<span class="lineNum">     189 </span><span class="lineCov">          1 : var o16 = JSON.parse('{&quot;a&quot;:1.5}');</span>
<span class="lineNum">     190 </span><span class="lineCov">          1 : var o17 = JSON.parse('{&quot;a&quot;:100}');</span>
<span class="lineNum">     191 </span><span class="lineCov">          1 : assertTrue(%HaveSameMap(o16, o17));</span>
<span class="lineNum">     192 </span><span class="lineCov">          1 : var o17_a = o17.a;</span>
<span class="lineNum">     193 </span><span class="lineCov">          1 : assertEquals(100, o17_a);</span>
<span class="lineNum">     194 </span><span class="lineCov">          1 : o17.a = 200;</span>
<span class="lineNum">     195 </span><span class="lineCov">          1 : assertEquals(100, o17_a);</span>
<span class="lineNum">     196 </span><span class="lineCov">          1 : assertEquals(200, o17.a);</span>
<span class="lineNum">     197 </span><span class="lineCov">          1 : </span>
<span class="lineNum">     198 </span><span class="lineCov">          1 : // Ensure normalizing results in ignored representations.</span>
<span class="lineNum">     199 </span><span class="lineCov">          1 : var o18 = {};</span>
<span class="lineNum">     200 </span><span class="lineCov">          1 : o18.field1 = 100;</span>
<span class="lineNum">     201 </span><span class="lineCov">          1 : o18.field2 = 1;</span>
<span class="lineNum">     202 </span><span class="lineCov">          1 : o18.to_delete = 100;</span>
<span class="lineNum">     203 </span><span class="lineCov">          1 : </span>
<span class="lineNum">     204 </span><span class="lineCov">          1 : var o19 = {};</span>
<span class="lineNum">     205 </span><span class="lineCov">          1 : o19.field1 = 100;</span>
<span class="lineNum">     206 </span><span class="lineCov">          1 : o19.field2 = 1.6;</span>
<span class="lineNum">     207 </span><span class="lineCov">          1 : o19.to_delete = 100;</span>
<span class="lineNum">     208 </span><span class="lineCov">          1 : </span>
<span class="lineNum">     209 </span><span class="lineCov">          1 : assertFalse(%HaveSameMap(o18, o19));</span>
<span class="lineNum">     210 </span><span class="lineCov">          1 : </span>
<span class="lineNum">     211 </span><span class="lineCov">          1 : delete o18.to_delete;</span>
<span class="lineNum">     212 </span><span class="lineCov">          1 : delete o19.to_delete;</span>
<span class="lineNum">     213 </span><span class="lineCov">          1 : </span>
<span class="lineNum">     214 </span><span class="lineCov">          1 : assertEquals(1, o18.field2);</span>
<span class="lineNum">     215 </span><span class="lineCov">          1 : assertEquals(1.6, o19.field2);</span>
<span class="lineNum">     216 </span><span class="lineCov">          1 : </span>
<span class="lineNum">     217 </span><span class="lineCov">          1 : // Test megamorphic keyed stub behaviour in combination with representations.</span>
<span class="lineNum">     218 </span><span class="lineCov">          1 : var some_object20 = {&quot;a&quot;:1};</span>
<span class="lineNum">     219 </span><span class="lineCov">          1 : var o20 = {};</span>
<span class="lineNum">     220 </span><span class="lineCov">          1 : o20.smi = 1;</span>
<span class="lineNum">     221 </span><span class="lineCov">          1 : o20.dbl = 1.5;</span>
<a name="222"><span class="lineNum">     222 </span><span class="lineCov">          1 : o20.obj = some_object20;</span></a>
<span class="lineNum">     223 </span><span class="lineCov">          1 : </span>
<span class="lineNum">     224 </span><span class="lineCov">          9 : function keyed_load(o, k) {</span>
<span class="lineNum">     225 </span><span class="lineCov">          9 :   return o[k];</span>
<a name="226"><span class="lineNum">     226 </span><span class="lineCov">          9 : }</span></a>
<span class="lineNum">     227 </span><span class="lineCov">          1 : </span>
<span class="lineNum">     228 </span><span class="lineCov">          9 : function keyed_store(o, k, v) {</span>
<span class="lineNum">     229 </span><span class="lineCov">          9 :   return o[k] = v;</span>
<span class="lineNum">     230 </span><span class="lineCov">          9 : }</span>
<span class="lineNum">     231 </span><span class="lineCov">          1 : </span>
<span class="lineNum">     232 </span><span class="lineCov">          1 : var smi20 = keyed_load(o20, &quot;smi&quot;);</span>
<span class="lineNum">     233 </span><span class="lineCov">          1 : var dbl20 = keyed_load(o20, &quot;dbl&quot;);</span>
<span class="lineNum">     234 </span><span class="lineCov">          1 : var obj20 = keyed_load(o20, &quot;obj&quot;);</span>
<span class="lineNum">     235 </span><span class="lineCov">          1 : keyed_load(o20, &quot;smi&quot;);</span>
<span class="lineNum">     236 </span><span class="lineCov">          1 : keyed_load(o20, &quot;dbl&quot;);</span>
<span class="lineNum">     237 </span><span class="lineCov">          1 : keyed_load(o20, &quot;obj&quot;);</span>
<span class="lineNum">     238 </span><span class="lineCov">          1 : keyed_load(o20, &quot;smi&quot;);</span>
<span class="lineNum">     239 </span><span class="lineCov">          1 : keyed_load(o20, &quot;dbl&quot;);</span>
<span class="lineNum">     240 </span><span class="lineCov">          1 : keyed_load(o20, &quot;obj&quot;);</span>
<span class="lineNum">     241 </span><span class="lineCov">          1 : </span>
<span class="lineNum">     242 </span><span class="lineCov">          1 : assertEquals(1, smi20);</span>
<span class="lineNum">     243 </span><span class="lineCov">          1 : assertEquals(1.5, dbl20);</span>
<span class="lineNum">     244 </span><span class="lineCov">          1 : assertEquals(some_object20, obj20);</span>
<span class="lineNum">     245 </span><span class="lineCov">          1 : </span>
<span class="lineNum">     246 </span><span class="lineCov">          1 : keyed_store(o20, &quot;smi&quot;, 100);</span>
<span class="lineNum">     247 </span><span class="lineCov">          1 : keyed_store(o20, &quot;dbl&quot;, 100);</span>
<span class="lineNum">     248 </span><span class="lineCov">          1 : keyed_store(o20, &quot;obj&quot;, 100);</span>
<span class="lineNum">     249 </span><span class="lineCov">          1 : keyed_store(o20, &quot;smi&quot;, 100);</span>
<span class="lineNum">     250 </span><span class="lineCov">          1 : keyed_store(o20, &quot;dbl&quot;, 100);</span>
<span class="lineNum">     251 </span><span class="lineCov">          1 : keyed_store(o20, &quot;obj&quot;, 100);</span>
<span class="lineNum">     252 </span><span class="lineCov">          1 : keyed_store(o20, &quot;smi&quot;, 100);</span>
<span class="lineNum">     253 </span><span class="lineCov">          1 : keyed_store(o20, &quot;dbl&quot;, 100);</span>
<span class="lineNum">     254 </span><span class="lineCov">          1 : keyed_store(o20, &quot;obj&quot;, 100);</span>
<span class="lineNum">     255 </span><span class="lineCov">          1 : </span>
<span class="lineNum">     256 </span><span class="lineCov">          1 : assertEquals(1, smi20);</span>
<span class="lineNum">     257 </span><span class="lineCov">          1 : assertEquals(1.5, dbl20);</span>
<span class="lineNum">     258 </span><span class="lineCov">          1 : assertEquals(some_object20, obj20);</span>
<span class="lineNum">     259 </span><span class="lineCov">          1 : </span>
<span class="lineNum">     260 </span><span class="lineCov">          1 : assertEquals(100, o20.smi);</span>
<span class="lineNum">     261 </span><span class="lineCov">          1 : assertEquals(100, o20.dbl);</span>
<a name="262"><span class="lineNum">     262 </span><span class="lineCov">          1 : assertEquals(100, o20.dbl);</span></a>
<span class="lineNum">     263 </span><span class="lineCov">          1 : </span>
<span class="lineNum">     264 </span><span class="lineCov">          3 : function attr_mismatch_obj(v, writable) {</span>
<span class="lineNum">     265 </span><span class="lineCov">          3 :   var o = {};</span>
<span class="lineNum">     266 </span><span class="lineCov">          3 :   // Assign twice to make the field non-constant.</span>
<span class="lineNum">     267 </span><span class="lineCov">          3 :   // TODO(ishell): update test once constant field tracking is done.</span>
<span class="lineNum">     268 </span><span class="lineCov">          3 :   o.some_value = 0;</span>
<span class="lineNum">     269 </span><span class="lineCov">          3 :   o.some_value = v;</span>
<span class="lineNum">     270 </span><span class="lineCov">          3 :   Object.defineProperty(o, &quot;second_value&quot;, {value:10, writable:writable});</span>
<span class="lineNum">     271 </span><span class="lineCov">          3 :   return o;</span>
<a name="272"><span class="lineNum">     272 </span><span class="lineCov">          3 : }</span></a>
<span class="lineNum">     273 </span><span class="lineCov">          1 : </span>
<span class="lineNum">     274 </span><span class="lineCov">          3 : function is_writable(o, p) {</span>
<span class="lineNum">     275 </span><span class="lineCov">          3 :   return Object.getOwnPropertyDescriptor(o,p).writable;</span>
<span class="lineNum">     276 </span><span class="lineCov">          3 : }</span>
<span class="lineNum">     277 </span><span class="lineCov">          1 : </span>
<span class="lineNum">     278 </span><span class="lineCov">          1 : var writable = attr_mismatch_obj(10, true);</span>
<span class="lineNum">     279 </span><span class="lineCov">          1 : var non_writable1 = attr_mismatch_obj(10.5, false);</span>
<span class="lineNum">     280 </span><span class="lineCov">          1 : assertTrue(is_writable(writable,&quot;second_value&quot;));</span>
<span class="lineNum">     281 </span><span class="lineCov">          1 : assertFalse(is_writable(non_writable1,&quot;second_value&quot;));</span>
<span class="lineNum">     282 </span><span class="lineCov">          1 : writable.some_value = 20.5;</span>
<span class="lineNum">     283 </span><span class="lineCov">          1 : assertTrue(is_writable(writable,&quot;second_value&quot;));</span>
<span class="lineNum">     284 </span><span class="lineCov">          1 : var non_writable2 = attr_mismatch_obj(10.5, false);</span>
<a name="285"><span class="lineNum">     285 </span><span class="lineCov">          1 : assertTrue(%HaveSameMap(non_writable1, non_writable2));</span></a>
<span class="lineNum">     286 </span><span class="lineCov">          1 : </span>
<span class="lineNum">     287 </span><span class="lineCov">          4 : function test_f(v) {</span>
<span class="lineNum">     288 </span><span class="lineCov">          4 :   var o = {};</span>
<span class="lineNum">     289 </span><span class="lineCov">          4 :   o.vbf = v;</span>
<span class="lineNum">     290 </span><span class="lineCov">          4 :   o.func = test_f;</span>
<span class="lineNum">     291 </span><span class="lineCov">          4 :   return o;</span>
<a name="292"><span class="lineNum">     292 </span><span class="lineCov">          4 : }</span></a>
<span class="lineNum">     293 </span><span class="lineCov">          1 : </span>
<span class="lineNum">     294 </span><span class="lineCov">          4 : function test_fic(o) {</span>
<span class="lineNum">     295 </span><span class="lineCov">          4 :   return o.vbf;</span>
<span class="lineNum">     296 </span><span class="lineCov">          4 : }</span>
<span class="lineNum">     297 </span><span class="lineCov">          1 : </span>
<span class="lineNum">     298 </span><span class="lineCov">          1 : var ftest1 = test_f(10);</span>
<span class="lineNum">     299 </span><span class="lineCov">          1 : var ftest2 = test_f(10);</span>
<span class="lineNum">     300 </span><span class="lineCov">          1 : var ftest3 = test_f(10.5);</span>
<span class="lineNum">     301 </span><span class="lineCov">          1 : var ftest4 = test_f(10);</span>
<span class="lineNum">     302 </span><span class="lineCov">          1 : assertFalse(%HaveSameMap(ftest1, ftest3));</span>
<span class="lineNum">     303 </span><span class="lineCov">          1 : assertTrue(%HaveSameMap(ftest3, ftest4));</span>
<span class="lineNum">     304 </span><span class="lineCov">          1 : ftest2.func = is_writable;</span>
<span class="lineNum">     305 </span><span class="lineCov">          1 : test_fic(ftest1);</span>
<span class="lineNum">     306 </span><span class="lineCov">          1 : test_fic(ftest2);</span>
<span class="lineNum">     307 </span><span class="lineCov">          1 : test_fic(ftest3);</span>
<span class="lineNum">     308 </span><span class="lineCov">          1 : test_fic(ftest4);</span>
<span class="lineNum">     309 </span><span class="lineCov">          1 : assertTrue(%HaveSameMap(ftest1, ftest3));</span>
<span class="lineNum">     310 </span><span class="lineCov">          1 : assertTrue(%HaveSameMap(ftest3, ftest4));</span>
<a name="311"><span class="lineNum">     311 </span><span class="lineCov">          1 : </span></a>
<span class="lineNum">     312 </span><span class="lineCov">          1 : // Test representations and transition conversions.</span>
<span class="lineNum">     313 </span><span class="lineCov">          3 : function read_first_double(o) {</span>
<span class="lineNum">     314 </span><span class="lineCov">          3 :   return o.first_double;</span>
<span class="lineNum">     315 </span><span class="lineCov">          3 : }</span>
<span class="lineNum">     316 </span><span class="lineCov">          1 : var df1 = {};</span>
<span class="lineNum">     317 </span><span class="lineCov">          1 : df1.first_double=1.6;</span>
<a name="318"><span class="lineNum">     318 </span><span class="lineCov">          1 : read_first_double(df1);</span></a>
<span class="lineNum">     319 </span><span class="lineCov">          1 : read_first_double(df1);</span>
<span class="lineNum">     320 </span><span class="lineCov">          1 : function some_function1() { return 10; }</span>
<span class="lineNum">     321 </span><span class="lineCov">          1 : var df2 = {};</span>
<a name="322"><span class="lineNum">     322 </span><span class="lineCov">          1 : df2.first_double = 1.7;</span></a>
<span class="lineNum">     323 </span><span class="lineCov">          1 : df2.second_function = some_function1;</span>
<span class="lineNum">     324 </span><span class="lineCov">          1 : function some_function2() { return 20; }</span>
<span class="lineNum">     325 </span><span class="lineCov">          1 : var df3 = {};</span>
<span class="lineNum">     326 </span><span class="lineCov">          1 : df3.first_double = 1.7;</span>
<span class="lineNum">     327 </span><span class="lineCov">          1 : df3.second_function = some_function2;</span>
<span class="lineNum">     328 </span><span class="lineCov">          1 : df1.first_double = 10;</span>
<span class="lineNum">     329 </span><span class="lineCov">          1 : read_first_double(df1);</span>
<a name="330"><span class="lineNum">     330 </span><span class="lineCov">          1 : </span></a>
<span class="lineNum">     331 </span><span class="lineCov">          1 : // Test boilerplates with computed values.</span>
<span class="lineNum">     332 </span><span class="lineCov">          4 : function none_boilerplate(a) {</span>
<span class="lineNum">     333 </span><span class="lineCov">          4 :   return {&quot;a_none&quot;:a};</span>
<span class="lineNum">     334 </span><span class="lineCov">          4 : }</span>
<span class="lineNum">     335 </span><span class="lineCov">          1 : %OptimizeFunctionOnNextCall(none_boilerplate);</span>
<span class="lineNum">     336 </span><span class="lineCov">          1 : var none_double1 = none_boilerplate(1.7);</span>
<span class="lineNum">     337 </span><span class="lineCov">          1 : var none_double2 = none_boilerplate(1.9);</span>
<span class="lineNum">     338 </span><span class="lineCov">          1 : assertTrue(%HaveSameMap(none_double1, none_double2));</span>
<span class="lineNum">     339 </span><span class="lineCov">          1 : assertEquals(1.7, none_double1.a_none);</span>
<span class="lineNum">     340 </span><span class="lineCov">          1 : assertEquals(1.9, none_double2.a_none);</span>
<span class="lineNum">     341 </span><span class="lineCov">          1 : none_double2.a_none = 3.5;</span>
<span class="lineNum">     342 </span><span class="lineCov">          1 : var none_double1 = none_boilerplate(1.7);</span>
<a name="343"><span class="lineNum">     343 </span><span class="lineCov">          1 : var none_double2 = none_boilerplate(3.5);</span></a>
<span class="lineNum">     344 </span><span class="lineCov">          1 : </span>
<span class="lineNum">     345 </span><span class="lineCov">          3 : function none_to_smi(a) {</span>
<span class="lineNum">     346 </span><span class="lineCov">          3 :   return {&quot;a_smi&quot;:a};</span>
<span class="lineNum">     347 </span><span class="lineCov">          3 : }</span>
<span class="lineNum">     348 </span><span class="lineCov">          1 : </span>
<span class="lineNum">     349 </span><span class="lineCov">          1 : var none_smi1 = none_to_smi(1);</span>
<span class="lineNum">     350 </span><span class="lineCov">          1 : var none_smi2 = none_to_smi(2);</span>
<span class="lineNum">     351 </span><span class="lineCov">          1 : %OptimizeFunctionOnNextCall(none_to_smi);</span>
<span class="lineNum">     352 </span><span class="lineCov">          1 : var none_smi3 = none_to_smi(3);</span>
<span class="lineNum">     353 </span><span class="lineCov">          1 : assertTrue(%HaveSameMap(none_smi1, none_smi2));</span>
<span class="lineNum">     354 </span><span class="lineCov">          1 : assertTrue(%HaveSameMap(none_smi1, none_smi3));</span>
<span class="lineNum">     355 </span><span class="lineCov">          1 : assertEquals(1, none_smi1.a_smi);</span>
<span class="lineNum">     356 </span><span class="lineCov">          1 : assertEquals(2, none_smi2.a_smi);</span>
<a name="357"><span class="lineNum">     357 </span><span class="lineCov">          1 : assertEquals(3, none_smi3.a_smi);</span></a>
<span class="lineNum">     358 </span><span class="lineCov">          1 : </span>
<span class="lineNum">     359 </span><span class="lineCov">          3 : function none_to_double(a) {</span>
<span class="lineNum">     360 </span><span class="lineCov">          3 :   return {&quot;a_double&quot;:a};</span>
<span class="lineNum">     361 </span><span class="lineCov">          3 : }</span>
<span class="lineNum">     362 </span><span class="lineCov">          1 : </span>
<span class="lineNum">     363 </span><span class="lineCov">          1 : var none_to_double1 = none_to_double(1.5);</span>
<span class="lineNum">     364 </span><span class="lineCov">          1 : var none_to_double2 = none_to_double(2.8);</span>
<span class="lineNum">     365 </span><span class="lineCov">          1 : %OptimizeFunctionOnNextCall(none_to_double);</span>
<span class="lineNum">     366 </span><span class="lineCov">          1 : var none_to_double3 = none_to_double(3.7);</span>
<span class="lineNum">     367 </span><span class="lineCov">          1 : assertTrue(%HaveSameMap(none_to_double1, none_to_double2));</span>
<span class="lineNum">     368 </span><span class="lineCov">          1 : assertTrue(%HaveSameMap(none_to_double1, none_to_double3));</span>
<span class="lineNum">     369 </span><span class="lineCov">          1 : assertEquals(1.5, none_to_double1.a_double);</span>
<span class="lineNum">     370 </span><span class="lineCov">          1 : assertEquals(2.8, none_to_double2.a_double);</span>
<a name="371"><span class="lineNum">     371 </span><span class="lineCov">          1 : assertEquals(3.7, none_to_double3.a_double);</span></a>
<span class="lineNum">     372 </span><span class="lineCov">          1 : </span>
<span class="lineNum">     373 </span><span class="lineCov">          3 : function none_to_object(a) {</span>
<span class="lineNum">     374 </span><span class="lineCov">          3 :   return {&quot;an_object&quot;:a};</span>
<span class="lineNum">     375 </span><span class="lineCov">          3 : }</span>
<span class="lineNum">     376 </span><span class="lineCov">          1 : </span>
<span class="lineNum">     377 </span><span class="lineCov">          1 : var none_to_object1 = none_to_object(true);</span>
<span class="lineNum">     378 </span><span class="lineCov">          1 : var none_to_object2 = none_to_object(false);</span>
<span class="lineNum">     379 </span><span class="lineCov">          1 : %OptimizeFunctionOnNextCall(none_to_object);</span>
<span class="lineNum">     380 </span><span class="lineCov">          1 : var none_to_object3 = none_to_object(3.7);</span>
<span class="lineNum">     381 </span><span class="lineCov">          1 : assertTrue(%HaveSameMap(none_to_object1, none_to_object2));</span>
<span class="lineNum">     382 </span><span class="lineCov">          1 : assertTrue(%HaveSameMap(none_to_object1, none_to_object3));</span>
<span class="lineNum">     383 </span><span class="lineCov">          1 : assertEquals(true, none_to_object1.an_object);</span>
<span class="lineNum">     384 </span><span class="lineCov">          1 : assertEquals(false, none_to_object2.an_object);</span>
<a name="385"><span class="lineNum">     385 </span><span class="lineCov">          1 : assertEquals(3.7, none_to_object3.an_object);</span></a>
<span class="lineNum">     386 </span><span class="lineCov">          1 : </span>
<span class="lineNum">     387 </span><span class="lineCov">          2 : function double_to_object(a) {</span>
<span class="lineNum">     388 </span><span class="lineCov">          2 :   var o = {&quot;d_to_h&quot;:1.8};</span>
<span class="lineNum">     389 </span><span class="lineCov">          2 :   o.d_to_h = a;</span>
<span class="lineNum">     390 </span><span class="lineCov">          2 :   return o;</span>
<span class="lineNum">     391 </span><span class="lineCov">          2 : }</span>
<span class="lineNum">     392 </span><span class="lineCov">          1 : </span>
<span class="lineNum">     393 </span><span class="lineCov">          1 : var dh1 = double_to_object(true);</span>
<span class="lineNum">     394 </span><span class="lineCov">          1 : var dh2 = double_to_object(false);</span>
<span class="lineNum">     395 </span><span class="lineCov">          1 : assertTrue(%HaveSameMap(dh1, dh2));</span>
<span class="lineNum">     396 </span><span class="lineCov">          1 : assertEquals(true, dh1.d_to_h);</span>
<a name="397"><span class="lineNum">     397 </span><span class="lineCov">          1 : assertEquals(false, dh2.d_to_h);</span></a>
<span class="lineNum">     398 </span><span class="lineCov">          1 : </span>
<span class="lineNum">     399 </span><span class="lineCov">          2 : function smi_to_object(a) {</span>
<span class="lineNum">     400 </span><span class="lineCov">          2 :   var o = {&quot;s_to_t&quot;:18};</span>
<span class="lineNum">     401 </span><span class="lineCov">          2 :   o.s_to_t = a;</span>
<span class="lineNum">     402 </span><span class="lineCov">          2 :   return o;</span>
<span class="lineNum">     403 </span><span class="lineCov">          2 : }</span>
<span class="lineNum">     404 </span><span class="lineCov">          1 : </span>
<span class="lineNum">     405 </span><span class="lineCov">          1 : var st1 = smi_to_object(true);</span>
<span class="lineNum">     406 </span><span class="lineCov">          1 : var st2 = smi_to_object(false);</span>
<span class="lineNum">     407 </span><span class="lineCov">          1 : assertTrue(%HaveSameMap(st1, st2));</span>
<span class="lineNum">     408 </span><span class="lineCov">          1 : assertEquals(true, st1.s_to_t);</span>
<span class="lineNum">     409 </span><span class="lineCov">          1 : assertEquals(false, st2.s_to_t);</span>
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.10</a></td></tr>
  </table>
  <br>

</body>
</html>
